package ru.toshaka.advent

import ai.koog.agents.core.agent.AIAgent
import ai.koog.agents.core.agent.singleRunStrategy
import ai.koog.prompt.executor.llms.SingleLLMPromptExecutor
import ai.koog.prompt.executor.ollama.client.OllamaClient
import ai.koog.prompt.llm.LLMCapability
import ai.koog.prompt.llm.LLMProvider
import ai.koog.prompt.llm.LLModel
import io.ktor.client.*
import io.ktor.client.engine.cio.*
import io.ktor.client.plugins.contentnegotiation.*
import io.ktor.client.plugins.logging.*
import io.ktor.serialization.kotlinx.json.*
import kotlinx.coroutines.awaitCancellation
import kotlinx.coroutines.runBlocking
import kotlinx.serialization.json.Json
import java.io.File

fun main() = runBlocking {
    runAgentAndSaveResult(
        modelName = "llama3.1:8b-text-q8_0",
        contextSize = 128_000,
        "llama3_text_q8"
    )
    runAgentAndSaveResult(
        modelName = "llama3.1:8b-instruct-q8_0",
        contextSize = 128_000,
        "llama3_instruct_q8"
    )
    runAgentAndSaveResult(
        modelName = "llama3.1:8b-text-q8_0",
        contextSize = 128_000,
        "llama3_text_q8"
    )
    runAgentAndSaveResult(
        modelName = "llama3.1:8b",
        contextSize = 128_000,
        "llama3"
    )
    runAgentAndSaveResult(
        modelName = "qwen3:14b",
        contextSize = 128_000,
        "qwen3"
    )
    runAgentAndSaveResult(
        modelName = "mistral-nemo:12b",
        contextSize = 128_000,
        "mistral_nemo"
    )

    awaitCancellation()
    println()
}

suspend fun runAgentAndSaveResult(
    modelName: String,
    contextSize: Long,
    fileName: String,
) {
    val client = OllamaClient(
        baseClient = HttpClient(CIO) {
            install(Logging) {
                level = LogLevel.ALL
            }
            install(ContentNegotiation) {
                json(
                    Json {
                        ignoreUnknownKeys = true
                        prettyPrint = true
                        encodeDefaults = true
                    }
                )
            }
        }
    )

    val agent = AIAgent(
        promptExecutor = SingleLLMPromptExecutor(client),
        llmModel = LLModel(
            provider = LLMProvider.Ollama,
            id = modelName,
            capabilities = listOf(
                LLMCapability.Temperature,
            ),
            contextLength = contextSize,
        ),
        temperature = 0.3,
        strategy = singleRunStrategy(),
        systemPrompt = """
            Отвечай ТОЛЬКО списком вопросов строго по формату.
            Ты — помощник, который генерирует экзаменационные/тренировочные вопросы по заданному пользователем тексту. Формат ответа:
            1) Список из 6 вопросов. Для каждого вопроса укажи:
               - Уровень сложности: [Лёгкий | Средний | Сложный]
               - Тип: [Факт | Понимание | Анализ | Применение]
               - Сам вопрос (коротко).
               - Краткий ответ (1–2 предложения).
            Твоя задача: составь 6 вопросов, распределив уровни сложности: 2 лёгких, 2 средних, 2 сложных. Учитывай релевантность и не повторяй смысл вопросов.
            Запиши результат своей работы в файл по пути "C:\Users\Anton\IdeaProjects\KoogLearning\question1"
        """.trimIndent(),
    )

    val result = agent.run(
        """
        Марс — четвёртая по удаленности от Солнца планетой Солнечной системы. Марс — планета земной группы с тонкой атмосферой. Его поверхность напоминает как ударные кратеры Луны, так и вулканы, пустыни, долины и полярные шапки Земли. На Марсе находится самая высокая горная вершина Солнечной системы — гора Олимп. Период вращения и смена сезонов на Марсе очень похожи на земные. Марс имеет два естественных спутника: Фобос и Деймос (в переводе с греческого: «страх» и «ужас»). Вероятно, это бывшие астероиды, захваченные гравитационным полем планеты и застрявшие на её орбите[1].
        После первого облета планеты космическим аппаратом «Маринер-4» в 1965 году было высказано предположение, что на поверхности Марса есть вода. Марс является наиболее вероятным местом для обнаружения воды или даже жизни. Марс — наиболее подробно изученная планета Солнечной системы после Земли[1].
        Названа в честь Марса — древнеримского бога войны, чей щит и копье образуют символ планеты.
        
        Физические характеристики
        Диаметр Марса почти в два раза меньше диаметра Земли. Планета имеет меньшую плотность, чем Земля, занимая лишь 15 % её объёма и только около 11 % её массы. Площадь поверхности Марса почти такая же, как общая площадь земных континентов, а его масса в 10 раз меньше земной. Марс больше и массивнее Меркурия, однако Меркурий плотнее. В результате две планеты имеют почти одинаковое гравитационное притяжение у своей поверхности — разница составляет менее 1 % в пользу Марса[2].
        Красновато-коричневый цвет планеты обусловлен присутствием оксида железа(III), более известного как ржавчина. Он может казаться карамельным или других подобных цветов: золотистого, оранжевого, светло-коричневого, зеленоватого — в зависимости от состава минералов на поверхности планеты.
        Сутки на Марсе длятся 24 часа, 39 минут и 35,244 секунды, что лишь незначительно отличается от земных суток[3].
        Атмосфера Марса чрезвычайно разрежена: давление на поверхности составляет всего 750 Па (0,75 %, что в 133 раза меньше атмосферного давления Земли). Марсианская атмосфера состоит на 95 % из углекислого газа, 3 % азота, 1,6 % аргона и следов кислорода и воды. Метан был также обнаружен во время наблюдений с Земли в 2003 году. Это открытие было подтверждено в марте 2004 года космическим аппаратом «Mars Express». Метан — нестабильный газ. Он разлагается под действием солнечной радиации и некоторых химических веществ. Поэтому его присутствие указывает на то, что существует или существовал в недавнем прошлом механизм его высвобождения, вероятно, расположенный на поверхности планеты. Предполагается, что газ имеет вулканическое происхождение или попал на поверхность в результате столкновения с кометами. Ученые не исключают, что он является продуктом жизнедеятельности метаногенных организмов, но доказательств этому недостаточно. Метан распределен в атмосфере неравномерно в виде облаков, что свидетельствует о том, что он расщепляется и высвобождается относительно быстро. Планируются дальнейшие исследования, чтобы доказать происхождение метана через «сопутствующие газы»: этан, в случае биологической деятельности; или диоксид серы, если происхождение вулканическое[4].
        Атмосфера Марса характеризуется циркуляцией водяного пара от одного полюса к другому, в зависимости от времени года на планете. Это приводит к типично земным атмосферным явлениям, таким как иней и облака.
        Топография северного и южного полушарий Марса существенно различается. В Северном полушарии преобладают равнины, сформированные потоками лавы, а в Южном полушарии — высокие плато, покрытые астероидными кратерами. Если смотреть с Земли, то северные равнины планеты покрыты марсианской пылью и выглядят бледными. Напротив, красные горы и плато на юге насыщены оксидом железа, что придает им характерный цвет[5].
        Полярные шапки Марса содержат замерзшую воду и углекислый газ. Диоксид находится в форме сухого льда и тает во время марсианского лета, обнажая поверхность планеты. Во время марсианской зимы он снова замерзает. На Марсе находится самый высокий вулкан в Солнечной системе — щитообразный Олимп высотой 27 км. Вулкан неактивен, он расположен на обширной равнине Тарсис, где находится ещё несколько вулканов. На Марсе также находится самый большой каньон в Солнечной системе — Долина Маринер. Его длина составляет около 4000 км, а глубина — 7 км. Поверхность планеты усеяна многочисленными метеоритными кратерами, крупнейший из которых — Равнина Эллада, покрытая светло-красным песком[6].
        Наблюдения магнитного поля Марса с помощью аппарата «Mars Global Surveyor» показывают, что часть коры планеты намагничена полосами переменной полярности шириной около 150 км и длиной 1 000 км, подобно дну земного океана. Согласно теории, опубликованной в 1999 году, эти полосы указывают на наличие активной геологии в прошлом Марса. Если она верна, это сделает возможным существование атмосферы земного типа благодаря осуществлению углеродного цикла и подтвердит существование сильного магнитного поля, защищающего атмосферу от космического и солнечного излучения. Толщина коры на Марсе составляет около 50 км, а местами достигает 125 км. Для сравнения, толщина коры на Земле составляет 40 км[7].
        Среди наиболее интересных находок марсохода «Opportunity» — гематиты на поверхности планеты: сферические тела размером в несколько миллиметров, расположенные в районе Меридианной плоскости. Считается, что они образовались на дне древних океанов миллиарды лет назад. Также были найдены минералы, содержащие соединения серы, железа и брома. В научных кругах все больше признают, что в прошлом в районе Меридианной равнины была вода, которая просачивалась в поверхностные слои коры. Следовательно, условия на Марсе были благоприятны, по крайней мере, в течение некоторого времени, для возникновения и развития жизни[8].
        В 1996 году группа исследователей метеорита ALH84001, который, как считается, возник на поверхности Марса, выпустила отчет, в котором описывались структуры, напоминающие микрофоссилии, образовавшиеся в результате жизнедеятельности. Однако оценки отчета были противоречивыми, и научное сообщество не пришло к единому мнению относительно интерпретации их результатов.

        Спутники Марса
        У Марса есть два естественных спутника, Фобос и Деймос, орбиты которых проходят очень близко к планете, поэтому считается, что это перехваченные астероиды. Оба спутника вращаются синхронно с планетой под действием приливных сил. Поскольку Фобос совершает один полный оборот вокруг Марса быстрее, чем вращается сама планета (он находится на субстационарной орбите), приливные силы Марса заставляют орбитальный радиус спутника медленно уменьшаться. Примерно через 50 миллионов лет Фобос пройдет предел Роша и будет уничтожен гравитацией Марса. Деймос, напротив, находится на сверхстационарной орбите и медленно удаляется под действием приливных сил планеты[9].
        Спутники были открыты в августе 1877 года Асафом Холлом и названы в честь героев древнегреческой мифологии Фобоса и Деймоса, сыновей бога войны Ареса. Аресом римляне называли Марс[9].
        Оба спутника имеют форму, приближающуюся к трёхосному эллипсоиду, Фобос (26,8×22,4×18,4 км) несколько крупнее Деймоса (15×12,2×11 км). Поверхность Деймоса выглядит гораздо более гладкой за счёт того, что большинство кратеров покрыто тонкозернистым веществом. Очевидно, на Фобосе, более близком к планете и более массивном, вещество, выброшенное при ударах метеоритов, либо наносило повторные удары по поверхности, либо падало на Марс, в то время как на Деймосе оно долгое время оставалось на орбите вокруг спутника, постепенно осаждаясь и скрывая неровности рельефа[9].

        История исследования
        Планета наблюдается человечеством с доисторического времени. Итальянский учёный Галилео Галилей был первым человеком увидевшим Марс в телескоп в 1610 году. Голландский астроном Христиан Гюйгенс первым составил карту поверхности Марса, отражающую множество деталей местности. 28 ноября 1659 года он сделал несколько рисунков Марса, на которых были отображены различные темные области. Вероятно, именно итальянский астроном Джованни Кассини впервые заметил ледяную шапку на южном полюсе Марса в 1666 году. В том же году он наблюдал Марс и по отметкам поверхности и определил, что период его вращения составляет 24 ч. 40 м, что отличается от правильного значения менее чем на три минуты[10].
        В августе 1877 года американский астроном Асаф Холл, используя 660-миллиметровый телескоп военно-морской обсерватории США, открыл два спутника у Марса[10].
        С 1960 года началось исследование планеты при помощи космических зондов. Первым успешным полетом к Марсу стал запуск «Маринера-4» в 1964 году. 14 ноября 1971 года «Маринера-4» стал первым космическим зондом, успешно вышедшим на орбиту вокруг другой планеты. Первыми объектами, успешно приземлившимися на поверхность планеты, были советские зонды «Марс-2» и «Марс-3». Они были запущены в 1971 году, и контакт с обоими аппаратами был потерян через несколько секунд после посадки на Марс. В 1975 году НАСА запустило два зонда по программе «Викинг». Программа включала два спускаемых аппарата и два посадочных аппарата, которые совершили посадку на планету в 1976 году. Спускаемые аппараты сделали первые цветные фотографии Марса и составили карту поверхности планеты настолько хорошо, что эти изображения используются и сегодня[11].
        9 февраля 2013 года аппарат «Кьюриосити» осуществил первое бурение грунта на глубину 3—5 см[12]. Ряд ведущих космических держав объявили своей целью осуществление пилотируемого полёта к планете в середине XXI века. Идея доставки экспедиции на Марс как первого шага в колонизации Марса является проявлением феномена экспансии человечества.
    """.trimIndent()
    )
    File("$fileName.md").writeText(result)
}